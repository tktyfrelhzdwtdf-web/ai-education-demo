<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Симулятор контроля выбора сварочных электродов</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #059669;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --border: #cbd5e1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .header-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .progress-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--gray);
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: var(--primary);
            color: white;
        }

        .progress-step.completed {
            background: var(--success);
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-info {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--info);
            padding: 20px;
            border-radius: 0 12px 12px 0;
            margin-bottom: 25px;
        }

        .task-params {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .param-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .param-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .param-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .electrode-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .electrode-item {
            padding: 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .electrode-item:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .electrode-item.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.1);
        }

        .electrode-item.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .electrode-item.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .electrode-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .electrode-desc {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: var(--light-gray);
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #059669;
        }

        .feedback {
            padding: 25px;
            border-radius: 16px;
            margin-top: 25px;
            display: none;
        }

        .feedback.correct {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success);
            display: block;
        }

        .feedback.incorrect {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--danger);
            display: block;
        }

        .feedback-title {
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-title.correct {
            color: var(--success);
        }

        .feedback-title.incorrect {
            color: var(--danger);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th,
        .results-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .results-table th {
            background: var(--light-gray);
            font-weight: 600;
            color: var(--dark);
        }

        .results-table .correct-cell {
            color: var(--success);
            font-weight: 600;
        }

        .results-table .incorrect-cell {
            color: var(--danger);
            font-weight: 600;
        }

        .final-score {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .score-number {
            font-size: 3rem;
            font-weight: 700;
            margin: 20px 0;
        }

        .score-excellent { color: var(--success); }
        .score-good { color: var(--warning); }
        .score-poor { color: var(--danger); }

        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-icon">
                <i class="fas fa-welding"></i>
            </div>
            <h1>Симулятор контроля выбора сварочных электродов</h1>
            <p class="subtitle">Образовательный тест для профессиональных сварщиков</p>
        </header>

        <div class="progress-bar" id="progressBar">
            <div class="progress-step active" data-step="1">1</div>
            <div class="progress-step" data-step="2">2</div>
            <div class="progress-step" data-step="3">3</div>
            <div class="progress-step" data-step="4">4</div>
            <div class="progress-step" data-step="5">5</div>
        </div>

        <div class="main-content">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-tasks"></i> Задание</h2>
                
                <div class="task-info">
                    <h3>Параметры сварки:</h3>
                    <div class="task-params" id="taskParams">
                        <!-- Заполняется JavaScript -->
                    </div>
                </div>

                <div class="electrode-list" id="electrodeList">
                    <!-- Заполняется JavaScript -->
                </div>

                <button id="checkBtn" class="btn" disabled>
                    <i class="fas fa-check"></i> Проверить выбор
                </button>
            </div>

            <div class="card">
                <h2 class="card-title"><i class="fas fa-lightbulb"></i> Обратная связь</h2>
                <div id="feedbackContainer">
                    <div id="initialFeedback">
                        <p>Выберите подходящий электрод из списка и нажмите "Проверить выбор" для получения обратной связи.</p>
                    </div>
                    
                    <div id="feedback" class="feedback">
                        <!-- Заполняется JavaScript -->
                    </div>
                    
                    <div id="loading" class="loading hidden">
                        <div class="spinner"></div>
                        <p>Проверяем ваш выбор...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="finalResults" class="hidden">
            <div class="final-score">
                <h2><i class="fas fa-award"></i> Тест завершен!</h2>
                <div class="score-number" id="finalScore"></div>
                <p id="scoreMessage"></p>
                <button id="restartBtn" class="btn btn-success">
                    <i class="fas fa-redo"></i> Пройти тест заново
                </button>
            </div>

            <div class="card" style="margin-top: 30px;">
                <h2 class="card-title"><i class="fas fa-list"></i> Детальные результаты</h2>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Задание</th>
                            <th>Параметры</th>
                            <th>Ваш выбор</th>
                            <th>Правильный ответ</th>
                            <th>Результат</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- Заполняется JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <footer>
            <p>Симулятор контроля выбора сварочных электродов | Образовательный тест для сварщиков</p>
            <p>© 2024 Все права защищены. Разработано в образовательных целях.</p>
        </footer>
    </div>

    <script>
        // База данных электродов
        const electrodeDatabase = {
            steel: [
                {
                    id: 'unii-13-55',
                    name: "УОНИ-13/55",
                    diameter: "2.5-5.0 мм",
                    current: "60-220 А",
                    positions: ["flat", "horizontal", "vertical"],
                    applications: "Ответственные конструкции из углеродистых и низколегированных сталей",
                    features: [
                        "Высокая пластичность и ударная вязкость",
                        "Отличная стойкость к образованию трещин",
                        "Подходит для работы в условиях низких температур"
                    ]
                },
                {
                    id: 'mr-3',
                    name: "МР-3",
                    diameter: "2.0-5.0 мм",
                    current: "50-220 А",
                    positions: ["flat", "horizontal", "vertical", "overhead"],
                    applications: "Универсальный электрод для углеродистых сталей",
                    features: [
                        "Легкое зажигание дуги",
                        "Стабильное горение дуги",
                        "Хорошее формирование шва"
                    ]
                }
            ],
            stainless: [
                {
                    id: 'cl-11',
                    name: "ЦЛ-11",
                    diameter: "2.5-4.0 мм",
                    current: "60-160 А",
                    positions: ["flat", "horizontal", "vertical"],
                    applications: "Сварка нержавеющих сталей типа 12Х18Н10Т",
                    features: [
                        "Высокая коррозионная стойкость",
                        "Отличная пластичность шва",
                        "Минимальное разбрызгивание"
                    ]
                }
            ],
            aluminum: [
                {
                    id: 'ozana-1',
                    name: "ОЗАНА-1",
                    diameter: "3.0-5.0 мм",
                    current: "90-200 А",
                    positions: ["flat", "horizontal"],
                    applications: "Сварка алюминиевых сплавов",
                    features: [
                        "Специальное покрытие для алюминия",
                        "Хорошая стабильность дуги",
                        "Минимальная пористость шва"
                    ]
                }
            ],
            cast_iron: [
                {
                    id: 'tch-4',
                    name: "ЦЧ-4",
                    diameter: "3.0-5.0 мм",
                    current: "90-180 А",
                    positions: ["flat", "horizontal"],
                    applications: "Сварка и наплавка чугуна",
                    features: [
                        "Графитовое покрытие",
                        "Минимальная усадка шва",
                        "Отсутствие трещин при охлаждении"
                    ]
                }
            ]
        };

        // Все возможные параметры для генерации заданий
        const materials = [
            { code: 'steel', name: 'Углеродистая сталь' },
            { code: 'stainless', name: 'Нержавеющая сталь' },
            { code: 'aluminum', name: 'Алюминий' },
            { code: 'cast_iron', name: 'Чугун' }
        ];

        const positions = [
            { code: 'flat', name: 'Нижнее', codeName: '1G/1F' },
            { code: 'horizontal', name: 'Горизонтальное', codeName: '2G/2F' },
            { code: 'vertical', name: 'Вертикальное', codeName: '3G/3F' },
            { code: 'overhead', name: 'Потолочное', codeName: '4G/4F' }
        ];

        // Глобальные переменные
        let currentTask = 1;
        let selectedElectrode = null;
        let taskResults = [];
        let currentTaskData = null;
        let hasAnsweredCurrentTask = false;

        // DOM элементы
        const taskParams = document.getElementById('taskParams');
        const electrodeList = document.getElementById('electrodeList');
        const checkBtn = document.getElementById('checkBtn');
        const feedbackContainer = document.getElementById('feedbackContainer');
        const initialFeedback = document.getElementById('initialFeedback');
        const feedback = document.getElementById('feedback');
        const loading = document.getElementById('loading');
        const finalResults = document.getElementById('finalResults');
        const finalScore = document.getElementById('finalScore');
        const scoreMessage = document.getElementById('scoreMessage');
        const resultsBody = document.getElementById('resultsBody');
        const restartBtn = document.getElementById('restartBtn');
        const progressBar = document.getElementById('progressBar');

        // Инициализация
        document.addEventListener('DOMContentLoaded', initTest);

        function initTest() {
            generateNewTask();
            restartBtn.addEventListener('click', restartTest);
        }

        function generateNewTask() {
            // Сбрасываем состояние для нового задания
            hasAnsweredCurrentTask = false;
            selectedElectrode = null;
            
            // Генерация случайных параметров
            const randomMaterial = materials[Math.floor(Math.random() * materials.length)];
            const randomThickness = Math.floor(Math.random() * 25) + 1; // 1-25 мм
            const randomPosition = positions[Math.floor(Math.random() * positions.length)];
            
            currentTaskData = {
                material: randomMaterial.code,
                materialName: randomMaterial.name,
                thickness: randomThickness,
                position: randomPosition.code,
                positionName: randomPosition.name,
                positionCode: randomPosition.codeName
            };

            updateTaskDisplay();
            generateElectrodeOptions();
            resetFeedbackDisplay(); // Сбрасываем обратную связь при переходе к новому заданию
        }

        function updateTaskDisplay() {
            taskParams.innerHTML = `
                <div class="param-item">
                    <div class="param-label">Материал</div>
                    <div class="param-value">${currentTaskData.materialName}</div>
                </div>
                <div class="param-item">
                    <div class="param-label">Толщина</div>
                    <div class="param-value">${currentTaskData.thickness} мм</div>
                </div>
                <div class="param-item">
                    <div class="param-label">Положение</div>
                    <div class="param-value">${currentTaskData.positionName}<br><small>(${currentTaskData.positionCode})</small></div>
                </div>
            `;
        }

        function generateElectrodeOptions() {
            // Получаем все доступные электроды
            const allElectrodes = [];
            Object.values(electrodeDatabase).forEach(materialElectrodes => {
                allElectrodes.push(...materialElectrodes);
            });

            // Перемешиваем массив
            const shuffledElectrodes = [...allElectrodes].sort(() => 0.5 - Math.random());
            
            // Берем первые 4-6 электродов для разнообразия
            const selectedElectrodes = shuffledElectrodes.slice(0, Math.floor(Math.random() * 3) + 4);

            electrodeList.innerHTML = '';
            checkBtn.disabled = true;

            selectedElectrodes.forEach(electrode => {
                const electrodeElement = document.createElement('div');
                electrodeElement.className = 'electrode-item';
                electrodeElement.dataset.id = electrode.id;
                electrodeElement.innerHTML = `
                    <div class="electrode-name">${electrode.name}</div>
                    <div class="electrode-desc">${electrode.diameter}, ${electrode.current}</div>
                `;
                electrodeElement.addEventListener('click', () => selectElectrode(electrodeElement, electrode.id));
                electrodeList.appendChild(electrodeElement);
            });
        }

        function selectElectrode(element, electrodeId) {
            // Снимаем выделение со всех
            document.querySelectorAll('.electrode-item').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Выделяем выбранный
            element.classList.add('selected');
            selectedElectrode = electrodeId;
            checkBtn.disabled = false;
        }

        function checkAnswer() {
            if (!selectedElectrode || hasAnsweredCurrentTask) return;

            hasAnsweredCurrentTask = true;
            
            // Показываем загрузку
            initialFeedback.classList.add('hidden');
            feedback.classList.add('hidden');
            loading.classList.remove('hidden');

            setTimeout(() => {
                const isCorrect = isElectrodeCorrect(selectedElectrode, currentTaskData);
                const correctElectrode = getCorrectElectrode(currentTaskData);
                
                showFeedback(isCorrect, selectedElectrode, correctElectrode);
                saveTaskResult(isCorrect, selectedElectrode, correctElectrode);

                loading.classList.add('hidden');
                feedback.classList.remove('hidden');
                
                // Обновляем кнопку
                checkBtn.textContent = 'Следующее задание';
                checkBtn.innerHTML = '<i class="fas fa-arrow-right"></i> Следующее задание';
                checkBtn.onclick = nextTask;
            }, 800);
        }

        function isElectrodeCorrect(electrodeId, taskData) {
            const electrodes = electrodeDatabase[taskData.material] || [];
            const selectedElectrode = electrodes.find(e => e.id === electrodeId);
            
            if (!selectedElectrode) return false;
            
            // Проверяем положение
            if (!selectedElectrode.positions.includes(taskData.position)) {
                return false;
            }
            
            // Проверяем диаметр по толщине (упрощенная логика)
            const minDiameter = getMinDiameterForThickness(taskData.thickness);
            const maxDiameter = getMaxDiameterForThickness(taskData.thickness);
            const electrodeDiameterRange = selectedElectrode.diameter.split('-');
            const electrodeMinDiameter = parseFloat(electrodeDiameterRange[0]);
            const electrodeMaxDiameter = parseFloat(electrodeDiameterRange[1]);
            
            // Проверяем пересечение диапазонов
            return !(electrodeMaxDiameter < minDiameter || electrodeMinDiameter > maxDiameter);
        }

        function getCorrectElectrode(taskData) {
            const electrodes = electrodeDatabase[taskData.material] || [];
            return electrodes.find(e => isElectrodeCorrect(e.id, taskData)) || electrodes[0];
        }

        function getMinDiameterForThickness(thickness) {
            if (thickness <= 3) return 2.0;
            if (thickness <= 6) return 2.5;
            if (thickness <= 12) return 3.0;
            return 4.0;
        }

        function getMaxDiameterForThickness(thickness) {
            if (thickness <= 3) return 2.5;
            if (thickness <= 6) return 3.2;
            if (thickness <= 12) return 4.0;
            return 5.0;
        }

        function showFeedback(isCorrect, selectedId, correctElectrode) {
            const selectedElectrode = findElectrodeById(selectedId);
            
            if (isCorrect) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                    <div class="feedback-title correct">
                        <i class="fas fa-check-circle"></i> Правильно!
                    </div>
                    <p>Отличный выбор! Электрод <strong>${selectedElectrode.name}</strong> идеально подходит для данных условий сварки.</p>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(16, 185, 129, 0.2); border-radius: 12px;">
                        <strong>Особенности этого электрода:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            ${selectedElectrode.features.map(f => `<li>${f}</li>`).join('')}
                        </ul>
                    </div>
                `;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `
                    <div class="feedback-title incorrect">
                        <i class="fas fa-times-circle"></i> Неверно!
                    </div>
                    <p>Электрод <strong>${selectedElectrode.name}</strong> не подходит для данных условий.</p>
                    <div style="margin-top: 15px;">
                        <strong>Правильный выбор:</strong> <span style="color: var(--success); font-weight: 600;">${correctElectrode.name}</span>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(239, 68, 68, 0.2); border-radius: 12px;">
                        <strong>Почему ваш выбор неправильный:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            ${getIncorrectReasons(selectedElectrode, correctElectrode, currentTaskData)}
                        </ul>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(59, 130, 246, 0.2); border-radius: 12px;">
                        <strong>Рекомендации:</strong>
                        <p>${getRecommendations(correctElectrode, currentTaskData)}</p>
                    </div>
                `;
            }
        }

        function findElectrodeById(id) {
            for (const material in electrodeDatabase) {
                const electrode = electrodeDatabase[material].find(e => e.id === id);
                if (electrode) return electrode;
            }
            return null;
        }

        function getIncorrectReasons(selected, correct, taskData) {
            const reasons = [];
            
            // Проверяем материал
            if (selected.applications !== correct.applications) {
                reasons.push('Электрод предназначен для другого типа материала');
            }
            
            // Проверяем положение
            if (!selected.positions.includes(taskData.position)) {
                reasons.push(`Электрод не предназначен для ${taskData.positionName} положения`);
            }
            
            // Проверяем диаметр
            const minDiameter = getMinDiameterForThickness(taskData.thickness);
            const maxDiameter = getMaxDiameterForThickness(taskData.thickness);
            const electrodeDiameterRange = selected.diameter.split('-');
            const electrodeMinDiameter = parseFloat(electrodeDiameterRange[0]);
            const electrodeMaxDiameter = parseFloat(electrodeDiameterRange[1]);
            
            if (electrodeMaxDiameter < minDiameter) {
                reasons.push('Диаметр электрода слишком мал для данной толщины металла');
            } else if (electrodeMinDiameter > maxDiameter) {
                reasons.push('Диаметр электрода слишком велик для данной толщины металла');
            }
            
            return reasons.length > 0 ? reasons : ['Электрод не соответствует требованиям для данных условий сварки'];
        }

        function getRecommendations(correctElectrode, taskData) {
            let recommendation = `Используйте электрод ${correctElectrode.name} для `;
            
            if (taskData.material === 'steel') {
                recommendation += 'ответственных конструкций из углеродистых сталей';
            } else if (taskData.material === 'stainless') {
                recommendation += 'сварки нержавеющих сталей, особенно для пищевого оборудования';
            } else if (taskData.material === 'aluminum') {
                recommendation += 'сварки алюминиевых сплавов с предварительным подогревом';
            } else if (taskData.material === 'cast_iron') {
                recommendation += 'сварки и наплавки чугуна методом "горячей" сварки';
            }
            
            return recommendation + '.';
        }

        function saveTaskResult(isCorrect, selectedId, correctElectrode) {
            taskResults.push({
                taskNumber: currentTask,
                parameters: `${currentTaskData.materialName}, ${currentTaskData.thickness} мм, ${currentTaskData.positionName}`,
                userChoice: findElectrodeById(selectedId)?.name || 'Не выбран',
                correctAnswer: correctElectrode.name,
                isCorrect: isCorrect
            });
        }

        function resetFeedbackDisplay() {
            // Сбрасываем отображение обратной связи при переходе к новому заданию
            feedback.classList.add('hidden');
            loading.classList.add('hidden');
            initialFeedback.classList.remove('hidden');
            
            // Сбрасываем обработчик кнопки на проверку
            checkBtn.onclick = checkAnswer;
            checkBtn.disabled = true;
        }

        function nextTask() {
            currentTask++;
            
            if (currentTask > 5) {
                showFinalResults();
            } else {
                // Обновляем прогресс
                updateProgressBar();
                
                // Генерируем новое задание (внутри этой функции происходит сброс обратной связи)
                generateNewTask();
            }
        }

        function updateProgressBar() {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                const stepNumber = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNumber < currentTask) {
                    step.classList.add('completed');
                } else if (stepNumber === currentTask) {
                    step.classList.add('active');
                }
            });
        }

        function showFinalResults() {
            const correctAnswers = taskResults.filter(r => r.isCorrect).length;
            const score = Math.round((correctAnswers / 5) * 100);
            
            // Обновляем прогресс (все шаги завершены)
            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('active');
                step.classList.add('completed');
            });
            
            // Показываем финальные результаты
            finalResults.classList.remove('hidden');
            
            // Устанавливаем оценку
            finalScore.textContent = `${score}%`;
            if (score >= 80) {
                finalScore.className = 'score-number score-excellent';
                scoreMessage.textContent = 'Отличный результат! Вы отлично разбираетесь в подборе сварочных электродов.';
            } else if (score >= 60) {
                finalScore.className = 'score-number score-good';
                scoreMessage.textContent = 'Хороший результат! У вас есть хорошая база знаний, но есть над чем поработать.';
            } else {
                finalScore.className = 'score-number score-poor';
                scoreMessage.textContent = 'Нужно больше практики! Повторите материал по подбору сварочных электродов.';
            }
            
            // Заполняем таблицу результатов
            resultsBody.innerHTML = '';
            taskResults.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.taskNumber}</td>
                    <td>${result.parameters}</td>
                    <td>${result.userChoice}</td>
                    <td>${result.correctAnswer}</td>
                    <td class="${result.isCorrect ? 'correct-cell' : 'incorrect-cell'}">
                        ${result.isCorrect ? '✓ Правильно' : '✗ Неверно'}
                    </td>
                `;
                resultsBody.appendChild(row);
            });
        }

        function restartTest() {
            currentTask = 1;
            taskResults = [];
            selectedElectrode = null;
            hasAnsweredCurrentTask = false;
            
            // Сбрасываем прогресс
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index === 0) step.classList.add('active');
            });
            
            // Скрываем финальные результаты
            finalResults.classList.add('hidden');
            
            // Генерируем новое первое задание
            generateNewTask();
        }

        // Назначаем обработчик кнопки
        checkBtn.addEventListener('click', checkAnswer);
    </script>
</body>
</html>

